version: '3.7'
services:
  nodejs:
    build:
      context: ./cds-services-manager/
      dockerfile: Dockerfile
    image: road2h-dmims
    container_name: services_manager_service
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - MONGODB_HOST=mongodb
      - MONGODB_PORT=27017
      - PORT=3010
      - MONGODB_LOGS=cds_sm_logs
      - MONGODB_TEMPLATES=templates
      - MONGODB_CIG_MODEL=tmr
      - TMR_HOST=tmrweb
      - TMR_PORT=8888
      - TMR_DB=tmrweb
      - TMR_CIG_CREATE=guideline/create
      - TMR_CIG_DELETE=guideline/delete
      - TMR_CIG_ADD=guidelines/add
      - TMR_CIG_GET=guidelines/cig/get
      - TMR_CIGS_INTERACTIONS=guidelines/interactions
      - ARGUMENTATION_ENGINE_URL=aba-plus-g.herokuapp.com/generate_explanations
    depends_on: 
      - db
    #  - .:/home/node/app
    #  - node_modules:/home/node/app/node_modules
    networks:
      - dmims
      - tmrwebx_cig_handler
    #command: ./wait-for.sh db:27017 -- /home/node/app/node_modules/.bin/nodemon app.js
  db:
    image: mongo:4.4.17
    restart: unless-stopped
    ports: 
        - "27017:27017"
    container_name: mongodb
    volumes:
      - ~/mongodata:/data/db
    networks:
      - dmims
#external_links: 
#  - tmrweb
networks:
  dmims: {}
  tmrwebx_cig_handler:
    external: true
#volumes: 
 # - ~/mongodata: